method filter(x)
    requires slseg(next, data, x, null);
    ensures slseg(next, data, x, null);
{
    prv := null;
    curr := x;
    while (curr != null) 
      invariant (lslseg(next, data, x, prv, prv.data) * prv |-> curr * uslseg(next, data, curr, null, prv.data))
             || (prv == null * x == curr * slseg(next, data, curr, null));
    {
      old_curr := curr;
      curr := curr.next;
      if (NonDet) {
        if (prv != null) {
          prv.next := curr;
        } else {
          x := curr;
        }
        free old_curr;
      } else {
        prv := old_curr;
      }
    }
}
