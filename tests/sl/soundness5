method filter(x)
    requires lseg(next, x, null);
    ensures lseg(next, x, null);
{
    prv := null;
    curr := x;
    while (curr != null) 
      invariant ((lseg(next, x,prv) * prv |-> curr || prv == null * x == curr) * lseg(next, curr,null));
    {
      if (Random) {
        if (prv != null) {
          prv.next := curr.next;
        } else {
          x := curr.next;
        }
        free curr;
      } else {
        prv := curr;
      }
      // possible access to freed location
      curr := curr.next;
    }
}
