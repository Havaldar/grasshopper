
method partition(x, y, z)
requires lseg(next, x, null) * y == null * z == null;
ensures lseg(next, y, null) * lseg(next, z, null);
{
    new y_last;
    new z_last;
    y := y_last;
    z := z_last;
    y.next := x;
    z.next := x;
    while (x != null)
        invariant lseg(next, x,null) * lseg(next, y,y_last) * lseg(next, z,z_last) * y_last |-> x * z_last |-> x;
    {
        if (Random) {
            z_last.next := x.next;
            y_last := x;
        } else {
            y_last.next := x.next;
            z_last := x;
        }
        x := x.next;
    }
    curr_y := y;
    curr_z := z;
    y := y.next;
    z := z.next;
    free curr_y;
    free curr_z;
}
