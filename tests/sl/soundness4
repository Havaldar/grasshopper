method pairwise_sum(x, y)
    requires slseg(next, data, x, null) * slseg(next, data, y, null);
    ensures slseg(next, data, x, null) * slseg(next, data, y, null) * slseg(next, data, returned, null);
{
    curr_x := x;
    curr_y := y;
    z := null;
    last_z := null;
    while (curr_x != null && curr_y != null) 
        invariant slseg(next, data, x, curr_x) * slseg(next, data, curr_x, null);
        invariant slseg(next, data, y, curr_y) * slseg(next, data, curr_y, null);
        invariant slseg(next, data, z, last_z) * (last_z == null * z == null || last_z |-> null);
        // missing conjunct in loop invariant
        // invariant last_z == null || curr_x == null || curr_y == null || last_z.data <= curr_x.data + curr_y.data;
    {
        tmp := last_z;
        new last_z;
        last_z.next := null;
        tmp.next := last_z;
        last_z.data := curr_x.data + curr_y.data;        
        if (z == null) {
           z := last_z;
        }
        curr_x := curr_x.next;
        curr_y := curr_y.next;
    }
    return z;
}
