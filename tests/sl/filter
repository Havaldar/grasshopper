
filter(x)
requires lseg(x, null)
ensures lseg(x, null)
{
    prv := null;
    curr := x;
    while (curr ~= null) (lseg(x,prv) * prv |-> curr * lseg(curr,null)) || 
                         (prv = null * x = curr * lseg(curr,null)) 
    {
      if (Random) {
        if (prv ~= null) {
          prv.next := curr.next;
        } else {
          x := curr.next;
        }
        free curr;
      } else {
        prv := curr;
      }
      curr := curr.next;
    }
}
