procedure dl_filter()
    requires dlseg(a, null, null, b);
    ensures dlseg(a, null, null, b);
{
    prv := null;
    curr := a;
    while (curr != null) 
      invariant dlseg(a,null,curr,prv) * dlseg(curr,prv,null,b);
    {
      if (Random) {
        tmp := curr.next;
        if (prv != null) {
            prv.next := curr.next;
        } else {
            a := tmp;
        }
        if (tmp != null) {
            tmp.back := prv;
        } else {
            b := prv;
        }
        free curr;
      } else {
        prv := curr;
      }
      curr := curr.next;
    }
}
